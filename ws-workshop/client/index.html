<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat WebSocket</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    h1 {
      color: #333;
    }
    #messages {
      border: 1px solid #ccc;
      height: 400px;
      overflow-y: auto;
      padding: 10px;
      background-color: white;
      margin-bottom: 20px;
      border-radius: 5px;
    }
    .message {
      margin: 5px 0;
      padding: 5px;
      background-color: #f9f9f9;
      border-left: 3px solid #007bff;
      border-radius: 3px;
    }
    .system-message {
      color: #666;
      font-style: italic;
      border-left-color: #999;
    }
    #input-form {
      display: flex;
      gap: 10px;
    }
    #message-input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 14px;
    }
    button {
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background-color: #0056b3;
    }
    #status {
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
    }
    .connected {
      background-color: #d4edda;
      color: #155724;
    }
    .disconnected {
      background-color: #f8d7da;
      color: #721c24;
    }
  </style>
</head>
<body>
  <h1>ðŸ’¬ Chat WebSocket</h1>
  <div id="status" class="disconnected">Connexion en cours...</div>
  <div id="messages"></div>
  <form id="input-form">
    <input 
      type="text" 
      id="message-input" 
      placeholder="Entrez votre pseudo ou un message..." 
      autocomplete="off"
    >
    <button type="submit">Envoyer</button>
  </form>

  <script>
    const socket = new WebSocket('ws://localhost:8080');
    const messagesDiv = document.getElementById('messages');
    const inputField = document.getElementById('message-input');
    const form = document.getElementById('input-form');
    const statusDiv = document.getElementById('status');
    let isConnected = false;

    socket.addEventListener('open', (event) => {
      console.log('WebSocket connection opened');
      isConnected = true;
      statusDiv.textContent = 'âœ… ConnectÃ©';
      statusDiv.className = 'connected';
      inputField.focus();
    });

    socket.addEventListener('message', (event) => {
      console.log('Received:', event.data);
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message';
      
      // Messages systÃ¨me (arrivÃ©es/dÃ©parts)
      if (event.data.includes('a rejoint') || event.data.includes('a quitte')) {
        messageDiv.className += ' system-message';
      }
      
      messageDiv.textContent = event.data;
      messagesDiv.appendChild(messageDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto-scroll vers le bas
    });

    socket.addEventListener('close', (event) => {
      console.log('WebSocket connection closed');
      isConnected = false;
      statusDiv.textContent = 'âŒ DÃ©connectÃ©';
      statusDiv.className = 'disconnected';
    });

    socket.addEventListener('error', (event) => {
      console.error('WebSocket error:', event);
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message system-message';
      messageDiv.textContent = 'âš ï¸ Erreur de connexion';
      messagesDiv.appendChild(messageDiv);
    });

    form.addEventListener('submit', (event) => {
      event.preventDefault();
      const message = inputField.value.trim();
      
      if (message && isConnected) {
        console.log('Sending:', message);
        socket.send(message);
        inputField.value = '';
        inputField.focus();
      }
    });
  </script>
</body>
</html>